<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MBTIæ€§æ ¼æµ‹è¯•</title>
    <!-- å¼•å…¥ html2canvas åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
            padding: 15px;
        }
        .container {
            max-width: 100%;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.25);
        }
        h1 {
            font-size: 1.3rem;
            margin-bottom: 6px;
        }
        .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 6px;
            background: linear-gradient(to right, #ff9a44, #ff6b6b);
            border-radius: 8px;
            transition: width 0.4s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            margin-top: 6px;
        }
        #question-container {
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        .question-number {
            font-size: 0.8rem;
            color: #3498db;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        .option {
            padding: 14px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .option.selected {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-color: #2980b9;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        .nav-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
        }
        #prev-btn {
            background-color: #e9ecef;
            color: #666;
        }
        #next-btn {
            background: linear-gradient(135deg, #ff9a44, #ff6b6b);
            color: white;
        }
        #next-btn:disabled {
            background: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }
        #submit-btn {
            display: none;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }

        /* æ¼é¢˜æç¤ºæ ·å¼ */
        .missing-alert {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .missing-alert button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            margin-top: 10px;
            cursor: pointer;
        }

        /* ç»“æœé¡µé¢æ ·å¼ */
        #result-container {
            display: none;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        .result-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }
        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .mbti-type {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
            color: #3498db;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .type-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .dimension-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        .dimension-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .dimension-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 8px 0;
            color: #2c3e50;
        }
        .dimension-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .dimension-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        .dimension-progress {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .section-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }
        .type-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
            line-height: 1.6;
        }
        .traits-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        .trait-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-left: 3px solid #3498db;
        }
        .trait-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .trait-value {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .career-suggestions {
            background: #e8f6f3;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2ecc71;
            margin: 15px 0;
        }
        .save-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .save-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }
        #save-image-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        #new-test-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .disclaimer {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #856404;
            text-align: center;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MBTIæ€§æ ¼æµ‹è¯•</h1>
            <div class="subtitle">æ¢ç´¢çœŸå®çš„è‡ªå·±ï¼Œå‘ç°æ€§æ ¼ä¼˜åŠ¿</div>
        </header>

        <!-- æ¼é¢˜æç¤º -->
        <div class="missing-alert" id="missing-alert">
            <p>æ‚¨è¿˜æœ‰ <span id="missing-count">0</span> é“é¢˜ç›®æœªå®Œæˆï¼</p>
            <button onclick="startMissingQuestionsFlow()">æŒ‰é¡ºåºå®Œæˆæ¼é¢˜</button>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">è¿›åº¦: 0/20</div>

        <div id="question-container">
            <div class="question-number" id="question-number">é¢˜ç›® 1</div>
            <div class="question-text" id="question-text"></div>
            <div class="options" id="options-container"></div>
            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn">ä¸Šä¸€é¢˜</button>
                <button class="nav-btn" id="next-btn" disabled>ä¸‹ä¸€é¢˜</button>
            </div>
            <button id="submit-btn">æäº¤æµ‹è¯•ï¼ŒæŸ¥çœ‹æŠ¥å‘Š</button>
        </div>

        <!-- ç»“æœé¡µé¢ -->
        <div id="result-container">
            <div class="result-header">
                <div class="result-title">æ‚¨çš„æ€§æ ¼åˆ†ææŠ¥å‘Š</div>
                <div class="result-subtitle">åŸºäºMBTIæ€§æ ¼ç±»å‹çš„ä¸“ä¸šè¯„ä¼°</div>
            </div>

            <div class="save-buttons">
                <button class="save-btn" id="save-image-btn">ğŸ’¾ ä¿å­˜æŠ¥å‘Šå›¾ç‰‡</button>
                <button class="save-btn" id="new-test-btn">ğŸ”„ é‡æ–°æµ‹è¯•</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...</div>
            </div>

            <div class="mbti-type" id="mbti-type">INTJ</div>
            <div class="type-title" id="type-title">å»ºç­‘å¸ˆ - å¯Œæœ‰æƒ³è±¡åŠ›å’Œæˆ˜ç•¥æ€§çš„æ€æƒ³å®¶</div>

            <div class="dimension-cards">
                <div class="dimension-card">
                    <div class="dimension-label">ç²¾åŠ›æ¥æº</div>
                    <div class="dimension-value" id="ei-value">E/I</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="ei-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">å¤–å‘(E) - å†…å‘(I)</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-label">è®¤çŸ¥æ–¹å¼</div>
                    <div class="dimension-value" id="sn-value">S/N</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="sn-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">å®æ„Ÿ(S) - ç›´è§‰(N)</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-label">åˆ¤æ–­æ–¹å¼</div>
                    <div class="dimension-value" id="tf-value">T/F</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="tf-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">æ€è€ƒ(T) - æƒ…æ„Ÿ(F)</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-label">ç”Ÿæ´»æ–¹å¼</div>
                    <div class="dimension-value" id="jp-value">J/P</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="jp-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">åˆ¤æ–­(J) - æ„ŸçŸ¥(P)</div>
                </div>
            </div>

            <div class="section-title">æ€§æ ¼ç‰¹è´¨åˆ†æ</div>
            <div class="traits-grid" id="traits-container"></div>

            <div class="section-title">æ€§æ ¼æè¿°</div>
            <div class="type-description" id="type-description"></div>

            <div class="section-title">èŒä¸šå‘å±•å»ºè®®</div>
            <div class="career-suggestions" id="career-suggestions"></div>

            <div class="section-title">äººé™…å…³ç³»å»ºè®®</div>
            <div class="type-description" id="relationship-advice"></div>

            <div class="disclaimer">
                <strong>è¯´æ˜ï¼š</strong>MBTIæ˜¯ä¸€ç§äººæ ¼ç±»å‹ç†è®ºæ¨¡å‹ï¼Œæœ¬æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒã€‚æ¯ä¸ªäººçš„æ€§æ ¼éƒ½æ˜¯ç‹¬ç‰¹è€Œå¤æ‚çš„ï¼Œä¸åº”è¢«å•ä¸€æµ‹è¯•å®šä¹‰ã€‚
            </div>
        </div>
    </div>

    <script>
        // MBTIæµ‹è¯•é¢˜ç›® - ç²¾ç®€20é¢˜ç‰ˆæœ¬
        const questions = [
            { 
                text: "åœ¨ç¤¾äº¤èšä¼šä¸­ï¼Œä½ é€šå¸¸ï¼š", 
                dimension: "EI",
                options: [
                    { text: "ä¸»åŠ¨ä¸é™Œç”Ÿäººäº¤è°ˆï¼Œè®¤è¯†æ–°æœ‹å‹", value: "E" },
                    { text: "åªä¸ç†Ÿæ‚‰çš„äººäº¤æµï¼Œæˆ–ç‹¬è‡ªå®‰é™å¾…ç€", value: "I" }
                ]
            },
            { 
                text: "ä½ æ›´å€¾å‘äºï¼š", 
                dimension: "SN",
                options: [
                    { text: "å…³æ³¨å…·ä½“äº‹å®å’Œå®é™…ç»†èŠ‚", value: "S" },
                    { text: "å…³æ³¨æ•´ä½“æ¨¡å¼å’Œæœªæ¥å¯èƒ½æ€§", value: "N" }
                ]
            },
            { 
                text: "åšå†³å®šæ—¶ï¼Œä½ æ›´æ³¨é‡ï¼š", 
                dimension: "TF",
                options: [
                    { text: "é€»è¾‘åˆ†æå’Œå®¢è§‚æ ‡å‡†", value: "T" },
                    { text: "ä¸ªäººä»·å€¼è§‚å’Œä»–äººæ„Ÿå—", value: "F" }
                ]
            },
            { 
                text: "ä½ çš„ç”Ÿæ´»æ–¹å¼æ›´åå‘ï¼š", 
                dimension: "JP",
                options: [
                    { text: "æœ‰è®¡åˆ’ã€æœ‰æ¡ç†ï¼Œå–œæ¬¢æå‰å®‰æ’", value: "J" },
                    { text: "çµæ´»ã€éšæ€§ï¼Œå–œæ¬¢ä¿æŒå¼€æ”¾æ€§", value: "P" }
                ]
            },
            { 
                text: "å½“ä½ éœ€è¦å……ç”µæ—¶ï¼Œä½ å€¾å‘äºï¼š", 
                dimension: "EI",
                options: [
                    { text: "ä¸ä»–äººç›¸å¤„ï¼Œå‚åŠ ç¤¾äº¤æ´»åŠ¨", value: "E" },
                    { text: "ç‹¬å¤„ï¼Œè¿›è¡Œå®‰é™çš„ä¸ªäººæ´»åŠ¨", value: "I" }
                ]
            },
            { 
                text: "å­¦ä¹ æ–°ä¸œè¥¿æ—¶ï¼Œä½ æ›´å–œæ¬¢ï¼š", 
                dimension: "SN",
                options: [
                    { text: "æŒ‰éƒ¨å°±ç­ï¼ŒæŒæ¡å…·ä½“æŠ€èƒ½", value: "S" },
                    { text: "ç†è§£æ¦‚å¿µï¼Œæ¢ç´¢å¤šç§å¯èƒ½æ€§", value: "N" }
                ]
            },
            { 
                text: "é¢å¯¹æ‰¹è¯„æ—¶ï¼Œä½ æ›´åœ¨æ„ï¼š", 
                dimension: "TF",
                options: [
                    { text: "æ‰¹è¯„æ˜¯å¦æœ‰é“ç†å’Œé€»è¾‘", value: "T" },
                    { text: "æ‰¹è¯„æ˜¯å¦å…¬å¹³å’Œé¡¾åŠæ„Ÿå—", value: "F" }
                ]
            },
            { 
                text: "å¤„ç†å·¥ä½œæ—¶ï¼Œä½ å€¾å‘äºï¼š", 
                dimension: "JP",
                options: [
                    { text: "æå‰è§„åˆ’ï¼ŒæŒ‰æ—¶å®Œæˆ", value: "J" },
                    { text: "åœ¨å‹åŠ›ä¸‹å·¥ä½œï¼Œçµæ´»è°ƒæ•´", value: "P" }
                ]
            },
            { 
                text: "åœ¨å›¢é˜Ÿä¸­ï¼Œä½ é€šå¸¸ï¼š", 
                dimension: "EI",
                options: [
                    { text: "ç§¯æå‘è¨€ï¼Œè¡¨è¾¾è§‚ç‚¹", value: "E" },
                    { text: "å…ˆå€¾å¬æ€è€ƒï¼Œå†é€‰æ‹©æ€§å‘è¨€", value: "I" }
                ]
            },
            { 
                text: "ä½ æ›´ç›¸ä¿¡ï¼š", 
                dimension: "SN",
                options: [
                    { text: "å®é™…ç»éªŒå’ŒéªŒè¯è¿‡çš„æ–¹æ³•", value: "S" },
                    { text: "ç›´è§‰å’Œåˆ›æ–°çš„æƒ³æ³•", value: "N" }
                ]
            },
            { 
                text: "å¤„ç†å†²çªæ—¶ï¼Œä½ æ›´æ³¨é‡ï¼š", 
                dimension: "TF",
                options: [
                    { text: "äº‹å®çœŸç›¸å’Œå…¬å¹³åŸåˆ™", value: "T" },
                    { text: "äººé™…å…³ç³»å’Œè°", value: "F" }
                ]
            },
            { 
                text: "é¢å¯¹æˆªæ­¢æ—¥æœŸï¼Œä½ é€šå¸¸ï¼š", 
                dimension: "JP",
                options: [
                    { text: "æå‰å®Œæˆï¼Œç•™æœ‰ä½™åœ°", value: "J" },
                    { text: "åˆ©ç”¨æœ€åæ—¶é—´é«˜æ•ˆå®Œæˆ", value: "P" }
                ]
            },
            { 
                text: "ä½ çš„èƒ½é‡ä¸»è¦æ¥è‡ªï¼š", 
                dimension: "EI",
                options: [
                    { text: "ä¸å¤–ç•Œçš„äº’åŠ¨å’Œæ´»åŠ¨", value: "E" },
                    { text: "å†…å¿ƒçš„æ€è€ƒå’Œåæ€", value: "I" }
                ]
            },
            { 
                text: "æè¿°äº‹ç‰©æ—¶ï¼Œä½ æ›´å€¾å‘äºï¼š", 
                dimension: "SN",
                options: [
                    { text: "å…·ä½“ã€å‡†ç¡®çš„æè¿°", value: "S" },
                    { text: "æ¯”å–»ã€è±¡å¾æ€§çš„æè¿°", value: "N" }
                ]
            },
            { 
                text: "è¯„ä»·ä»–äººæ—¶ï¼Œä½ æ›´çœ‹é‡ï¼š", 
                dimension: "TF",
                options: [
                    { text: "èƒ½åŠ›å’Œæˆå°±", value: "T" },
                    { text: "äººå“å’ŒåŠ¨æœº", value: "F" }
                ]
            },
            { 
                text: "æ—…è¡Œæ—¶ï¼Œä½ æ›´å–œæ¬¢ï¼š", 
                dimension: "JP",
                options: [
                    { text: "è¯¦ç»†çš„è¡Œç¨‹è®¡åˆ’", value: "J" },
                    { text: "éšæ€§æ¢ç´¢ï¼Œçµæ´»å®‰æ’", value: "P" }
                ]
            },
            { 
                text: "å®Œæˆä»»åŠ¡åï¼Œä½ å€¾å‘äºï¼š", 
                dimension: "EI",
                options: [
                    { text: "ç«‹å³å¼€å§‹æ–°çš„ç¤¾äº¤æˆ–æ´»åŠ¨", value: "E" },
                    { text: "éœ€è¦ç‹¬å¤„æ—¶é—´æ¥æ¢å¤ç²¾åŠ›", value: "I" }
                ]
            },
            { 
                text: "è§£å†³é—®é¢˜æ—¶ï¼Œä½ æ›´ä¾èµ–ï¼š", 
                dimension: "SN",
                options: [
                    { text: "è¿‡å»çš„ç»éªŒå’Œå·²çŸ¥æ–¹æ³•", value: "S" },
                    { text: "æ–°çš„æ€è·¯å’Œåˆ›æ„æ–¹æ¡ˆ", value: "N" }
                ]
            },
            { 
                text: "åšå‡ºé‡è¦å†³å®šæ—¶ï¼Œä½ ä¸»è¦è€ƒè™‘ï¼š", 
                dimension: "TF",
                options: [
                    { text: "åˆ©å¼Šåˆ†æå’Œé•¿è¿œå½±å“", value: "T" },
                    { text: "ä¸ªäººä»·å€¼è§‚å’Œä»–äººæ„Ÿå—", value: "F" }
                ]
            },
            { 
                text: "å¯¹äºç”Ÿæ´»ï¼Œä½ æ›´å€¾å‘äºï¼š", 
                dimension: "JP",
                options: [
                    { text: "æœ‰è®¡åˆ’ã€å¯é¢„æµ‹çš„ç”Ÿæ´»æ–¹å¼", value: "J" },
                    { text: "å……æ»¡å˜åŒ–å’ŒæƒŠå–œçš„ç”Ÿæ´»æ–¹å¼", value: "P" }
                ]
            }
        ];

        // MBTIç±»å‹è¯¦ç»†ä¿¡æ¯
        const mbtiTypes = {
            "INTJ": {
                title: "å»ºç­‘å¸ˆ - å¯Œæœ‰æƒ³è±¡åŠ›å’Œæˆ˜ç•¥æ€§çš„æ€æƒ³å®¶",
                description: "INTJå‹çš„äººæ˜¯å®Œç¾ä¸»ä¹‰è€…ï¼Œä»–ä»¬å¼ºçƒˆåœ°è¦æ±‚ä¸ªäººè‡ªç”±å’Œèƒ½åŠ›ï¼Œåœ¨è‡ªå·±ç‹¬åˆ›çš„æ€æƒ³ä¸­ï¼Œä¸å¯åŠ¨æ‘‡çš„ä¿¡ä»°ä¿ƒä½¿ä»–ä»¬è¾¾åˆ°ç›®æ ‡ã€‚INTJå‹çš„äººæ€ç»´ä¸¥è°¨ã€æœ‰é€»è¾‘æ€§ã€è¶³æ™ºå¤šè°‹ï¼Œèƒ½å¤Ÿçœ‹åˆ°æ–°è®¡åˆ’å®è¡Œåçš„ç»“æœã€‚ä»–ä»¬å¯¹è‡ªå·±å’Œåˆ«äººéƒ½å¾ˆè‹›æ±‚ï¼Œå¾€å¾€å‡ ä¹åŒæ ·å¼ºç¡¬åœ°å¼ºè¿«åˆ«äººå’Œè‡ªå·±ã€‚",
                traits: [
                    { name: "æˆ˜ç•¥æ€ç»´", value: "æå¼º" },
                    { name: "ç‹¬ç«‹æ€§", value: "å¾ˆå¼º" },
                    { name: "æœæ–­æ€§", value: "å¼º" },
                    { name: "æ±‚çŸ¥æ¬²", value: "æå¼º" },
                    { name: "ç»„ç»‡èƒ½åŠ›", value: "å¼º" },
                    { name: "åˆ›æ–°æ€§", value: "å¾ˆå¼º" }
                ],
                careers: "é€‚åˆé¢†åŸŸï¼šç§‘ç ”ã€æŠ€æœ¯ã€æ•™è‚²ã€æ³•å¾‹ã€é‡‘èã€ç®¡ç†å’¨è¯¢ç­‰ã€‚é€‚åˆèŒä¸šï¼šç§‘å­¦å®¶ã€å·¥ç¨‹å¸ˆã€å¾‹å¸ˆã€æŠ•èµ„åˆ†æå¸ˆã€ç³»ç»Ÿåˆ†æå¸ˆã€å¤§å­¦æ•™æˆç­‰ã€‚",
                relationships: "åœ¨äººé™…å…³ç³»ä¸­ï¼ŒINTJå€¾å‘äºæ·±åº¦è€Œéå¹¿åº¦çš„äº¤å¾€ã€‚ä»–ä»¬çè§†ä¸ç†è§£ä»–ä»¬å¤æ‚å†…å¿ƒä¸–ç•Œçš„äººå»ºç«‹æ·±åšè”ç³»ï¼Œè™½ç„¶å¤–è¡¨å¯èƒ½æ˜¾å¾—å†·é™ç–ç¦»ï¼Œä½†å¯¹äº²å¯†å…³ç³»éå¸¸å¿ è¯šå’ŒæŠ•å…¥ã€‚"
            },
            "INTP": {
                title: "é€»è¾‘å­¦å®¶ - åˆ›æ–°å‘æ˜å®¶",
                description: "INTPå‹çš„äººæ˜¯è§£å†³ç†æ€§é—®é¢˜è€…ï¼Œä»–ä»¬å¾ˆæœ‰æ‰æ™ºå’Œæ¡ç†æ€§ï¼Œä»¥åŠåˆ›é€ æ‰åçš„çªå‡ºè¡¨ç°ã€‚INTPå‹çš„äººå¤–è¡¨å¹³é™ã€ç¼„é»˜ã€è¶…ç„¶ï¼Œå†…å¿ƒå´ä¸“å¿ƒè‡´å¿—äºåˆ†æé—®é¢˜ã€‚ä»–ä»¬è‹›æ±‚ç²¾ç»†ã€æƒ¯äºæ€€ç–‘ã€‚",
                traits: [
                    { name: "é€»è¾‘åˆ†æ", value: "æå¼º" },
                    { name: "åˆ›é€ åŠ›", value: "å¾ˆå¼º" },
                    { name: "å¥½å¥‡å¿ƒ", value: "æå¼º" },
                    { name: "ç‹¬ç«‹æ€§", value: "å¾ˆå¼º" },
                    { name: "çµæ´»æ€§", value: "å¼º" },
                    { name: "å®¢è§‚æ€§", value: "å¾ˆå¼º" }
                ],
                careers: "é€‚åˆé¢†åŸŸï¼šè®¡ç®—æœºæŠ€æœ¯ã€ç†è®ºç ”ç©¶ã€å­¦æœ¯é¢†åŸŸã€é‡‘èåˆ†æã€æ³•å¾‹åˆ†æç­‰ã€‚é€‚åˆèŒä¸šï¼šè½¯ä»¶å·¥ç¨‹å¸ˆã€ç†è®ºç‰©ç†å­¦å®¶ã€æ•°å­¦å®¶ã€å“²å­¦å®¶ã€ç ”ç©¶åˆ†æå¸ˆç­‰ã€‚",
                relationships: "INTPåœ¨äººé™…å…³ç³»ä¸­é‡è§†æ™ºåŠ›ä¸Šçš„å…±é¸£ï¼Œå–œæ¬¢ä¸èƒ½å¤Ÿæ¿€å‘ä»–ä»¬æ€ç»´çš„äººäº¤å¾€ã€‚ä»–ä»¬å¯èƒ½éœ€è¦åŠªåŠ›è¡¨è¾¾æƒ…æ„Ÿï¼Œä½†å¯¹äº²å¯†çš„äººä¼šå±•ç°å‡ºæ·±åˆ»çš„å¿ è¯šå’Œç‹¬ç‰¹çš„å…³æ€€æ–¹å¼ã€‚"
            },
            "ENTJ": {
                title: "æŒ‡æŒ¥å®˜ - å¤§èƒ†ã€å¯Œæœ‰æƒ³è±¡åŠ›çš„é¢†å¯¼è€…",
                description: "ENTJå‹çš„äººæ˜¯ä¼Ÿå¤§çš„é¢†å¯¼è€…å’Œå†³ç­–äººã€‚ä»–ä»¬èƒ½è½»æ˜“åœ°çœ‹å‡ºäº‹ç‰©å…·æœ‰çš„å¯èƒ½æ€§ï¼Œå¾ˆé«˜å…´æŒ‡å¯¼åˆ«äººï¼Œä½¿ä»–ä»¬çš„æƒ³è±¡æˆä¸ºç°å®ã€‚ä»–ä»¬æ˜¯å¤´è„‘çµæ´»ã€å¿ƒèƒ¸å®½é˜”ã€åšè§ˆç¾¤ä¹¦çš„äººï¼Œå¥½å¥‡å¤šé—®ã€‚",
                traits: [
                    { name: "é¢†å¯¼åŠ›", value: "æå¼º" },
                    { name: "å†³æ–­åŠ›", value: "å¾ˆå¼º" },
                    { name: "æˆ˜ç•¥æ€ç»´", value: "å¼º" },
                    { name: "ç»„ç»‡èƒ½åŠ›", value: "æå¼º" },
                    { name: "æ²Ÿé€šèƒ½åŠ›", value: "å¾ˆå¼º" },
                    { name: "æ‰§è¡ŒåŠ›", value: "å¼º" }
                ],
                careers: "é€‚åˆé¢†åŸŸï¼šç®¡ç†ã€å•†ä¸šã€é‡‘èã€å’¨è¯¢ã€æ”¿æ²»ã€æ³•å¾‹ç­‰ã€‚é€‚åˆèŒä¸šï¼šCEOã€é¡¹ç›®ç»ç†ã€å¾‹å¸ˆã€ç®¡ç†é¡¾é—®ã€æ”¿æ²»å®¶ç­‰ã€‚",
                relationships: "ENTJåœ¨äººé™…å…³ç³»ä¸­ç›´æ¥è€Œå¦è¯šï¼Œé‡è§†æ•ˆç‡å’Œç›®æ ‡çš„å®ç°ã€‚ä»–ä»¬æ¬£èµæœ‰èƒ½åŠ›ã€æœ‰æŠ±è´Ÿçš„ä¼™ä¼´ï¼Œå¹¶æ„¿æ„ä¸ºé‡è¦çš„äººæä¾›åšå®šçš„æ”¯æŒå’ŒæŒ‡å¯¼ã€‚"
            }
            // å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–ç±»å‹...
        };

        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let dimensionScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        let isMissingQuestionsMode = false;
        let missingQuestions = [];

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            showQuestion(currentQuestion);
            updateProgress();
            
            document.getElementById('prev-btn').addEventListener('click', prevQuestion);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('submit-btn').addEventListener('click', submitTest);
            document.getElementById('save-image-btn').addEventListener('click', saveAsImage);
            document.getElementById('new-test-btn').addEventListener('click', newTest);
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion(index) {
            const question = questions[index];
            document.getElementById('question-number').textContent = `é¢˜ç›® ${index + 1}`;
            document.getElementById('question-text').textContent = question.text;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option ${answers[index] === i ? 'selected' : ''}`;
                optionElement.textContent = option.text;
                optionElement.addEventListener('click', () => selectOption(i));
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = index === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submit-btn').style.display = index === questions.length - 1 ? 'block' : 'none';
            
            updateNextButton();
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            showQuestion(currentQuestion);
            
            if (isMissingQuestionsMode) {
                const nextMissingIndex = missingQuestions.findIndex(q => q > currentQuestion);
                if (nextMissingIndex !== -1) {
                    setTimeout(() => {
                        currentQuestion = missingQuestions[nextMissingIndex];
                        showQuestion(currentQuestion);
                        updateProgress();
                    }, 200);
                } else {
                    setTimeout(() => {
                        isMissingQuestionsMode = false;
                        currentQuestion = questions.length - 1;
                        showQuestion(currentQuestion);
                        updateProgress();
                        alert('æ‰€æœ‰æ¼é¢˜å·²å®Œæˆï¼ç°åœ¨å¯ä»¥æäº¤æµ‹è¯•ã€‚');
                    }, 200);
                }
            } else {
                if (currentQuestion < questions.length - 1) {
                    setTimeout(() => {
                        currentQuestion++;
                        showQuestion(currentQuestion);
                        updateProgress();
                    }, 200);
                } else {
                    updateNextButton();
                }
            }
        }

        // æ›´æ–°ä¸‹ä¸€é¢˜æŒ‰é’®çŠ¶æ€
        function updateNextButton() {
            const nextButton = document.getElementById('next-btn');
            nextButton.disabled = answers[currentQuestion] === null;
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestion < questions.length - 1 && answers[currentQuestion] !== null) {
                currentQuestion++;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `è¿›åº¦: ${currentQuestion + 1}/${questions.length}`;
        }

        // æ£€æŸ¥æ¼é¢˜
        function checkMissingQuestions() {
            return answers.filter(answer => answer === null).length;
        }

        // è·å–æ‰€æœ‰æ¼é¢˜çš„ç´¢å¼•
        function getMissingQuestions() {
            return answers
                .map((answer, index) => answer === null ? index : -1)
                .filter(index => index !== -1);
        }

        // å¼€å§‹æ¼é¢˜æµç¨‹
        function startMissingQuestionsFlow() {
            missingQuestions = getMissingQuestions();
            if (missingQuestions.length > 0) {
                isMissingQuestionsMode = true;
                currentQuestion = missingQuestions[0];
                showQuestion(currentQuestion);
                updateProgress();
                document.getElementById('missing-alert').style.display = 'none';
            }
        }

        // è®¡ç®—MBTIç±»å‹
        function calculateMBTI() {
            // é‡ç½®åˆ†æ•°
            dimensionScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            
            // è®¡ç®—å„ç»´åº¦åˆ†æ•°
            answers.forEach((answerIndex, questionIndex) => {
                if (answerIndex !== null) {
                    const question = questions[questionIndex];
                    const selectedValue = question.options[answerIndex].value;
                    dimensionScores[selectedValue]++;
                }
            });
            
            // ç¡®å®šMBTIç±»å‹
            let mbti = '';
            mbti += dimensionScores.E >= dimensionScores.I ? 'E' : 'I';
            mbti += dimensionScores.S >= dimensionScores.N ? 'S' : 'N';
            mbti += dimensionScores.T >= dimensionScores.F ? 'T' : 'F';
            mbti += dimensionScores.J >= dimensionScores.P ? 'J' : 'P';
            
            return mbti;
        }

        // æäº¤æµ‹è¯•
        function submitTest() {
            const missingCount = checkMissingQuestions();
            
            if (missingCount > 0) {
                document.getElementById('missing-count').textContent = missingCount;
                document.getElementById('missing-alert').style.display = 'block';
                return;
            }
            
            showResults();
        }

        // æ˜¾ç¤ºç»“æœ
        function showResults() {
            const mbtiType = calculateMBTI();
            const typeInfo = mbtiTypes[mbtiType] || mbtiTypes["INTJ"];
            
            // æ›´æ–°MBTIç±»å‹æ˜¾ç¤º
            document.getElementById('mbti-type').textContent = mbtiType;
            document.getElementById('type-title').textContent = typeInfo.title;
            document.getElementById('type-description').textContent = typeInfo.description;
            document.getElementById('career-suggestions').textContent = typeInfo.careers;
            document.getElementById('relationship-advice').textContent = typeInfo.relationships;
            
            // æ›´æ–°ç»´åº¦æ˜¾ç¤º
            updateDimensionDisplays();
            
            // æ›´æ–°ç‰¹è´¨ç½‘æ ¼
            const traitsContainer = document.getElementById('traits-container');
            traitsContainer.innerHTML = '';
            typeInfo.traits.forEach(trait => {
                const traitCard = document.createElement('div');
                traitCard.className = 'trait-card';
                traitCard.innerHTML = `
                    <div class="trait-name">${trait.name}</div>
                    <div class="trait-value">${trait.value}</div>
                `;
                traitsContainer.appendChild(traitCard);
            });
            
            // æ˜¾ç¤ºæŠ¥å‘Šé¡µé¢
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('progress-text').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.getElementById('missing-alert').style.display = 'none';
        }

        // æ›´æ–°ç»´åº¦æ˜¾ç¤º
        function updateDimensionDisplays() {
            // EIç»´åº¦
            const eiTotal = dimensionScores.E + dimensionScores.I;
            const eiPercent = (dimensionScores.E / eiTotal) * 100;
            document.getElementById('ei-value').textContent = `E ${dimensionScores.E} | I ${dimensionScores.I}`;
            document.getElementById('ei-progress').style.width = `${eiPercent}%`;
            
            // SNç»´åº¦
            const snTotal = dimensionScores.S + dimensionScores.N;
            const snPercent = (dimensionScores.S / snTotal) * 100;
            document.getElementById('sn-value').textContent = `S ${dimensionScores.S} | N ${dimensionScores.N}`;
            document.getElementById('sn-progress').style.width = `${snPercent}%`;
            
            // TFç»´åº¦
            const tfTotal = dimensionScores.T + dimensionScores.F;
            const tfPercent = (dimensionScores.T / tfTotal) * 100;
            document.getElementById('tf-value').textContent = `T ${dimensionScores.T} | F ${dimensionScores.F}`;
            document.getElementById('tf-progress').style.width = `${tfPercent}%`;
            
            // JPç»´åº¦
            const jpTotal = dimensionScores.J + dimensionScores.P;
            const jpPercent = (dimensionScores.J / jpTotal) * 100;
            document.getElementById('jp-value').textContent = `J ${dimensionScores.J} | P ${dimensionScores.P}`;
            document.getElementById('jp-progress').style.width = `${jpPercent}%`;
        }

        // ä¿å­˜ä¸ºå›¾ç‰‡
        function saveAsImage() {
            const saveButton = document.getElementById('save-image-btn');
            const loading = document.getElementById('loading');
            
            saveButton.disabled = true;
            saveButton.textContent = 'ç”Ÿæˆä¸­...';
            loading.style.display = 'block';
            
            const saveButtons = document.querySelector('.save-buttons');
            saveButtons.style.display = 'none';
            
            html2canvas(document.getElementById('result-container'), {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const imageURL = canvas.toDataURL('image/png');
                
                const downloadLink = document.createElement('a');
                downloadLink.href = imageURL;
                downloadLink.download = 'MBTIæ€§æ ¼æµ‹è¯•æŠ¥å‘Š.png';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                saveButtons.style.display = 'flex';
                saveButton.disabled = false;
                saveButton.textContent = 'ğŸ’¾ ä¿å­˜æŠ¥å‘Šå›¾ç‰‡';
                loading.style.display = 'none';
                
            }).catch(error => {
                console.error('ç”Ÿæˆå›¾ç‰‡å¤±è´¥:', error);
                alert('ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                
                saveButtons.style.display = 'flex';
                saveButton.disabled = false;
                saveButton
