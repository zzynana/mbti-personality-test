<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MBTI性格测试</title>
    <!-- 引入 html2canvas 库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
            padding: 15px;
        }
        .container {
            max-width: 100%;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.25);
        }
        h1 {
            font-size: 1.3rem;
            margin-bottom: 6px;
        }
        .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 6px;
            background: linear-gradient(to right, #ff9a44, #ff6b6b);
            border-radius: 8px;
            transition: width 0.4s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            margin-top: 6px;
        }
        #question-container {
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        .question-number {
            font-size: 0.8rem;
            color: #3498db;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }
        .option {
            padding: 14px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            text-align: center;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .option.selected {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-color: #2980b9;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        .nav-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
        }
        #prev-btn {
            background-color: #e9ecef;
            color: #666;
        }
        #next-btn {
            background: linear-gradient(135deg, #ff9a44, #ff6b6b);
            color: white;
        }
        #next-btn:disabled {
            background: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }
        #submit-btn {
            display: none;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }

        /* 漏题提示样式 */
        .missing-alert {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .missing-alert button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            margin-top: 10px;
            cursor: pointer;
        }

        /* 结果页面样式 */
        #result-container {
            display: none;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
        }
        .result-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }
        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .mbti-type {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
            color: #3498db;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .type-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .dimension-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        .dimension-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .dimension-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 8px 0;
            color: #2c3e50;
        }
        .dimension-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .dimension-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        .dimension-progress {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .section-title {
            font-size: 1.1rem;
            color: #2c3e50;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }
        .type-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
            line-height: 1.6;
        }
        .traits-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        .trait-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-left: 3px solid #3498db;
        }
        .trait-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .trait-value {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .career-suggestions {
            background: #e8f6f3;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2ecc71;
            margin: 15px 0;
        }
        .save-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .save-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }
        #save-image-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        #new-test-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .disclaimer {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #856404;
            text-align: center;
        }
        
        /* 加载动画 */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MBTI性格测试</h1>
            <div class="subtitle">探索真实的自己，发现性格优势</div>
        </header>

        <!-- 漏题提示 -->
        <div class="missing-alert" id="missing-alert">
            <p>您还有 <span id="missing-count">0</span> 道题目未完成！</p>
            <button onclick="startMissingQuestionsFlow()">按顺序完成漏题</button>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="progress-text" id="progress-text">进度: 0/20</div>

        <div id="question-container">
            <div class="question-number" id="question-number">题目 1</div>
            <div class="question-text" id="question-text"></div>
            <div class="options" id="options-container"></div>
            <div class="nav-buttons">
                <button class="nav-btn" id="prev-btn">上一题</button>
                <button class="nav-btn" id="next-btn" disabled>下一题</button>
            </div>
            <button id="submit-btn">提交测试，查看报告</button>
        </div>

        <!-- 结果页面 -->
        <div id="result-container">
            <div class="result-header">
                <div class="result-title">您的性格分析报告</div>
                <div class="result-subtitle">基于MBTI性格类型的专业评估</div>
            </div>

            <div class="save-buttons">
                <button class="save-btn" id="save-image-btn">💾 保存报告图片</button>
                <button class="save-btn" id="new-test-btn">🔄 重新测试</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>正在生成图片...</div>
            </div>

            <div class="mbti-type" id="mbti-type">INTJ</div>
            <div class="type-title" id="type-title">建筑师 - 富有想象力和战略性的思想家</div>

            <div class="dimension-cards">
                <div class="dimension-card">
                    <div class="dimension-label">精力来源</div>
                    <div class="dimension-value" id="ei-value">E/I</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="ei-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">外向(E) - 内向(I)</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-label">认知方式</div>
                    <div class="dimension-value" id="sn-value">S/N</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="sn-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">实感(S) - 直觉(N)</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-label">判断方式</div>
                    <div class="dimension-value" id="tf-value">T/F</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="tf-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">思考(T) - 情感(F)</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-label">生活方式</div>
                    <div class="dimension-value" id="jp-value">J/P</div>
                    <div class="dimension-bar">
                        <div class="dimension-progress" id="jp-progress" style="width: 50%; background: linear-gradient(to right, #e74c3c, #3498db);"></div>
                    </div>
                    <div class="dimension-label">判断(J) - 感知(P)</div>
                </div>
            </div>

            <div class="section-title">性格特质分析</div>
            <div class="traits-grid" id="traits-container"></div>

            <div class="section-title">性格描述</div>
            <div class="type-description" id="type-description"></div>

            <div class="section-title">职业发展建议</div>
            <div class="career-suggestions" id="career-suggestions"></div>

            <div class="section-title">人际关系建议</div>
            <div class="type-description" id="relationship-advice"></div>

            <div class="disclaimer">
                <strong>说明：</strong>MBTI是一种人格类型理论模型，本测试结果仅供参考。每个人的性格都是独特而复杂的，不应被单一测试定义。
            </div>
        </div>
    </div>

    <script>
        // MBTI测试题目 - 精简20题版本
        const questions = [
            { 
                text: "在社交聚会中，你通常：", 
                dimension: "EI",
                options: [
                    { text: "主动与陌生人交谈，认识新朋友", value: "E" },
                    { text: "只与熟悉的人交流，或独自安静待着", value: "I" }
                ]
            },
            { 
                text: "你更倾向于：", 
                dimension: "SN",
                options: [
                    { text: "关注具体事实和实际细节", value: "S" },
                    { text: "关注整体模式和未来可能性", value: "N" }
                ]
            },
            { 
                text: "做决定时，你更注重：", 
                dimension: "TF",
                options: [
                    { text: "逻辑分析和客观标准", value: "T" },
                    { text: "个人价值观和他人感受", value: "F" }
                ]
            },
            { 
                text: "你的生活方式更偏向：", 
                dimension: "JP",
                options: [
                    { text:有计划、有条理，喜欢提前安排", value: "J" },
                    { text: "灵活、随性，喜欢保持开放性", value: "P" }
                ]
            },
            { 
                text: "当你需要充电时，你倾向于：", 
                dimension: "EI",
                options: [
                    { text: "与他人相处，参加社交活动", value: "E" },
                    { text: "独处，进行安静的个人活动", value: "I" }
                ]
            },
            { 
                text: "学习新东西时，你更喜欢：", 
                dimension: "SN",
                options: [
                    { text: "按部就班，掌握具体技能", value: "S" },
                    { text: "理解概念，探索多种可能性", value: "N" }
                ]
            },
            { 
                text: "面对批评时，你更在意：", 
                dimension: "TF",
                options: [
                    { text: "批评是否有道理和逻辑", value: "T" },
                    { text: "批评是否公平和顾及感受", value: "F" }
                ]
            },
            { 
                text: "处理工作时，你倾向于：", 
                dimension: "JP",
                options: [
                    { text: "提前规划，按时完成", value: "J" },
                    { text: "在压力下工作，灵活调整", value: "P" }
                ]
            },
            { 
                text: "在团队中，你通常：", 
                dimension: "EI",
                options: [
                    { text: "积极发言，表达观点", value: "E" },
                    { text: "先倾听思考，再选择性发言", value: "I" }
                ]
            },
            { 
                text: "你更相信：", 
                dimension: "SN",
                options: [
                    { text: "实际经验和验证过的方法", value: "S" },
                    { text: "直觉和创新的想法", value: "N" }
                ]
            },
            { 
                text: "处理冲突时，你更注重：", 
                dimension: "TF",
                options: [
                    { text: "事实真相和公平原则", value: "T" },
                    { text: "人际关系和谐", value: "F" }
                ]
            },
            { 
                text: "面对截止日期，你通常：", 
                dimension: "JP",
                options: [
                    { text: "提前完成，留有余地", value: "J" },
                    { text: "利用最后时间高效完成", value: "P" }
                ]
            },
            { 
                text: "你的能量主要来自：", 
                dimension: "EI",
                options: [
                    { text: "与外界的互动和活动", value: "E" },
                    { text: "内心的思考和反思", value: "I" }
                ]
            },
            { 
                text: "描述事物时，你更倾向于：", 
                dimension: "SN",
                options: [
                    { text: "具体、准确的描述", value: "S" },
                    { text: "比喻、象征性的描述", value: "N" }
                ]
            },
            { 
                text: "评价他人时，你更看重：", 
                dimension: "TF",
                options: [
                    { text: "能力和成就", value: "T" },
                    { text: "人品和动机", value: "F" }
                ]
            },
            { 
                text: "旅行时，你更喜欢：", 
                dimension: "JP",
                options: [
                    { text: "详细的行程计划", value: "J" },
                    { text: "随性探索，灵活安排", value: "P" }
                ]
            },
            { 
                text: "完成任务后，你倾向于：", 
                dimension: "EI",
                options: [
                    { text: "立即开始新的社交或活动", value: "E" },
                    { text: "需要独处时间来恢复精力", value: "I" }
                ]
            },
            { 
                text: "解决问题时，你更依赖：", 
                dimension: "SN",
                options: [
                    { text: "过去的经验和已知方法", value: "S" },
                    { text: "新的思路和创意方案", value: "N" }
                ]
            },
            { 
                text: "做出重要决定时，你主要考虑：", 
                dimension: "TF",
                options: [
                    { text: "利弊分析和长远影响", value: "T" },
                    { text: "个人价值观和他人感受", value: "F" }
                ]
            },
            { 
                text: "对于生活，你更倾向于：", 
                dimension: "JP",
                options: [
                    { text: "有计划、可预测的生活方式", value: "J" },
                    { text: "充满变化和惊喜的生活方式", value: "P" }
                ]
            }
        ];

        // MBTI类型详细信息
        const mbtiTypes = {
            "INTJ": {
                title: "建筑师 - 富有想象力和战略性的思想家",
                description: "INTJ型的人是完美主义者，他们强烈地要求个人自由和能力，在自己独创的思想中，不可动摇的信仰促使他们达到目标。INTJ型的人思维严谨、有逻辑性、足智多谋，能够看到新计划实行后的结果。他们对自己和别人都很苛求，往往几乎同样强硬地强迫别人和自己。",
                traits: [
                    { name: "战略思维", value: "极强" },
                    { name: "独立性", value: "很强" },
                    { name: "果断性", value: "强" },
                    { name: "求知欲", value: "极强" },
                    { name: "组织能力", value: "强" },
                    { name: "创新性", value: "很强" }
                ],
                careers: "适合领域：科研、技术、教育、法律、金融、管理咨询等。\n适合职业：科学家、工程师、律师、投资分析师、系统分析师、大学教授等。",
                relationships: "在人际关系中，INTJ倾向于深度而非广度的交往。他们珍视与理解他们复杂内心世界的人建立深厚联系，虽然外表可能显得冷静疏离，但对亲密关系非常忠诚和投入。"
            },
            "INTP": {
                title: "逻辑学家 - 创新发明家",
                description: "INTP型的人是解决理性问题者，他们很有才智和条理性，以及创造才华的突出表现。INTP型的人外表平静、缄默、超然，内心却专心致志于分析问题。他们苛求精细、惯于怀疑。",
                traits: [
                    { name: "逻辑分析", value: "极强" },
                    { name: "创造力", value: "很强" },
                    { name: "好奇心", value: "极强" },
                    { name: "独立性", value: "很强" },
                    { name: "灵活性", value: "强" },
                    { name: "客观性", value: "很强" }
                ],
                careers: "适合领域：计算机技术、理论研究、学术领域、金融分析、法律分析等。\n适合职业：软件工程师、理论物理学家、数学家、哲学家、研究分析师等。",
                relationships: "INTP在人际关系中重视智力上的共鸣，喜欢与能够激发他们思维的人交往。他们可能需要努力表达情感，但对亲密的人会展现出深刻的忠诚和独特的关怀方式。"
            }
            // 其他14种类型的数据可以类似添加...
        };

        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let dimensionScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
        let isMissingQuestionsMode = false;
        let missingQuestions = [];

        // 初始化页面
        function init() {
            showQuestion(currentQuestion);
            updateProgress();
            
            document.getElementById('prev-btn').addEventListener('click', prevQuestion);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('submit-btn').addEventListener('click', submitTest);
            document.getElementById('save-image-btn').addEventListener('click', saveAsImage);
            document.getElementById('new-test-btn').addEventListener('click', newTest);
        }

        // 显示题目
        function showQuestion(index) {
            const question = questions[index];
            document.getElementById('question-number').textContent = `题目 ${index + 1}`;
            document.getElementById('question-text').textContent = question.text;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = `option ${answers[index] === i ? 'selected' : ''}`;
                optionElement.textContent = option.text;
                optionElement.addEventListener('click', () => selectOption(i));
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = index === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submit-btn').style.display = index === questions.length - 1 ? 'block' : 'none';
            
            updateNextButton();
        }

        // 选择选项
        function selectOption(optionIndex) {
            answers[currentQuestion] = optionIndex;
            showQuestion(currentQuestion);
            
            if (isMissingQuestionsMode) {
                const nextMissingIndex = missingQuestions.findIndex(q => q > currentQuestion);
                if (nextMissingIndex !== -1) {
                    setTimeout(() => {
                        currentQuestion = missingQuestions[nextMissingIndex];
                        showQuestion(currentQuestion);
                        updateProgress();
                    }, 200);
                } else {
                    setTimeout(() => {
                        isMissingQuestionsMode = false;
                        currentQuestion = questions.length - 1;
                        showQuestion(currentQuestion);
                        updateProgress();
                        alert('所有漏题已完成！现在可以提交测试。');
                    }, 200);
                }
            } else {
                if (currentQuestion < questions.length - 1) {
                    setTimeout(() => {
                        currentQuestion++;
                        showQuestion(currentQuestion);
                        updateProgress();
                    }, 200);
                } else {
                    updateNextButton();
                }
            }
        }

        // 更新下一题按钮状态
        function updateNextButton() {
            const nextButton = document.getElementById('next-btn');
            nextButton.disabled = answers[currentQuestion] === null;
        }

        // 上一题
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // 下一题
        function nextQuestion() {
            if (currentQuestion < questions.length - 1 && answers[currentQuestion] !== null) {
                currentQuestion++;
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // 更新进度
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `进度: ${currentQuestion + 1}/${questions.length}`;
        }

        // 检查漏题
        function checkMissingQuestions() {
            return answers.filter(answer => answer === null).length;
        }

        // 获取所有漏题的索引
        function getMissingQuestions() {
            return answers
                .map((answer, index) => answer === null ? index : -1)
                .filter(index => index !== -1);
        }

        // 开始漏题流程
        function startMissingQuestionsFlow() {
            missingQuestions = getMissingQuestions();
            if (missingQuestions.length > 0) {
                isMissingQuestionsMode = true;
                currentQuestion = missingQuestions[0];
                showQuestion(currentQuestion);
                updateProgress();
                document.getElementById('missing-alert').style.display = 'none';
            }
        }

        // 计算MBTI类型
        function calculateMBTI() {
            // 重置分数
            dimensionScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            
            // 计算各维度分数
            answers.forEach((answerIndex, questionIndex) => {
                if (answerIndex !== null) {
                    const question = questions[questionIndex];
                    const selectedValue = question.options[answerIndex].value;
                    dimensionScores[selectedValue]++;
                }
            });
            
            // 确定MBTI类型
            let mbti = '';
            mbti += dimensionScores.E >= dimensionScores.I ? 'E' : 'I';
            mbti += dimensionScores.S >= dimensionScores.N ? 'S' : 'N';
            mbti += dimensionScores.T >= dimensionScores.F ? 'T' : 'F';
            mbti += dimensionScores.J >= dimensionScores.P ? 'J' : 'P';
            
            return mbti;
        }

        // 提交测试
        function submitTest() {
            const missingCount = checkMissingQuestions();
            
            if (missingCount > 0) {
                document.getElementById('missing-count').textContent = missingCount;
                document.getElementById('missing-alert').style.display = 'block';
                return;
            }
            
            showResults();
        }

        // 显示结果
        function showResults() {
            const mbtiType = calculateMBTI();
            const typeInfo = mbtiTypes[mbtiType] || mbtiTypes["INTJ"]; // 默认显示INTJ信息
            
            // 更新MBTI类型显示
            document.getElementById('mbti-type').textContent = mbtiType;
            document.getElementById('type-title').textContent = typeInfo.title;
            document.getElementById('type-description').textContent = typeInfo.description;
            document.getElementById('career-suggestions').textContent = typeInfo.careers;
            document.getElementById('relationship-advice').textContent = typeInfo.relationships;
            
            // 更新维度显示
            updateDimensionDisplays();
            
            // 更新特质网格
            const traitsContainer = document.getElementById('traits-container');
            traitsContainer.innerHTML = '';
            typeInfo.traits.forEach(trait => {
                const traitCard = document.createElement('div');
                traitCard.className = 'trait-card';
                traitCard.innerHTML = `
                    <div class="trait-name">${trait.name}</div>
                    <div class="trait-value">${trait.value}</div>
                `;
                traitsContainer.appendChild(traitCard);
            });
            
            // 显示报告页面
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('result-container').style.display = 'block';
            document.getElementById('progress-text').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.getElementById('missing-alert').style.display = 'none';
        }

        // 更新维度显示
        function updateDimensionDisplays() {
            // EI维度
            const eiTotal = dimensionScores.E + dimensionScores.I;
            const eiPercent = (dimensionScores.E / eiTotal) * 100;
            document.getElementById('ei-value').textContent = `E ${dimensionScores.E} | I ${dimensionScores.I}`;
            document.getElementById('ei-progress').style.width = `${eiPercent}%`;
            
            // SN维度
            const snTotal = dimensionScores.S + dimensionScores.N;
            const snPercent = (dimensionScores.S / snTotal) * 100;
            document.getElementById('sn-value').textContent = `S ${dimensionScores.S} | N ${dimensionScores.N}`;
            document.getElementById('sn-progress').style.width = `${snPercent}%`;
            
            // TF维度
            const tfTotal = dimensionScores.T + dimensionScores.F;
            const tfPercent = (dimensionScores.T / tfTotal) * 100;
            document.getElementById('tf-value').textContent = `T ${dimensionScores.T} | F ${dimensionScores.F}`;
            document.getElementById('tf-progress').style.width = `${tfPercent}%`;
            
            // JP维度
            const jpTotal = dimensionScores.J + dimensionScores.P;
            const jpPercent = (dimensionScores.J / jpTotal) * 100;
            document.getElementById('jp-value').textContent = `J ${dimensionScores.J} | P ${dimensionScores.P}`;
            document.getElementById('jp-progress').style.width = `${jpPercent}%`;
        }

        // 保存为图片
        function saveAsImage() {
            const saveButton = document.getElementById('save-image-btn');
            const loading = document.getElementById('loading');
            
            saveButton.disabled = true;
            saveButton.textContent = '生成中...';
            loading.style.display = 'block';
            
            const saveButtons = document.querySelector('.save-buttons');
            saveButtons.style.display = 'none';
            
            html2canvas(document.getElementById('result-container'), {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                const imageURL = canvas.toDataURL('image/png');
                
                const downloadLink = document.createElement('a');
                downloadLink.href = imageURL;
                downloadLink.download = 'MBTI性格测试报告.png';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                saveButtons.style.display = 'flex';
                saveButton.disabled = false;
                saveButton.textContent = '💾 保存报告图片';
                loading.style.display = 'none';
                
            }).catch(error => {
                console.error('生成图片失败:', error);
                alert('生成失败，请稍后重试');
                
                saveButtons.style.display = 'flex';
                saveButton.disabled = false;
                saveButton.textContent = '💾 保存报告图片';
                loading.style.display = 'none';
            });
        }

        // 重新测试
        function newTest() {
            if (confirm('确定要重新开始测试吗？当前结果将会丢失。')) {
                currentQuestion = 0;
                answers = new Array(questions.length).fill(null);
                dimensionScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
                isMissingQuestionsMode = false;
                missingQuestions = [];
                
                document.getElementById('question-container').style.display = 'block';
                document.getElementById('result-container').style.display = 'none';
                document.getElementById('progress-text').style.display = 'block';
                document.querySelector('.progress-container').style.display = 'block';
                
                showQuestion(currentQuestion);
                updateProgress();
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>